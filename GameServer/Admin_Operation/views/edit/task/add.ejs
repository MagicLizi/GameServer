<script type="text/javascript">
    $(function () {
        $('#Circul_Open_Time').datetimepicker();
        $('#Circul_Over_Time').datetimepicker();
        $('#Circul_Show_Time').datetimepicker();
        $('#Open_Time').datetimepicker();
        $('#Over_Time').datetimepicker();
    });
</script>
<div class="pagetitle">
    <a href="/task">返回列表</a>
</div>
<div class="message">
    <%-message%>
</div>
<form id="form1" name="form1" method="post">
<td class="data">
    <input type="submit" name="add" id="add" value="提交">
</td>
<table width="99%" border="0" cellpadding="0" cellspacing="1" bgcolor="#c0de98">
    <tr class="title">
        <td colspan="4">任务配置</td>
    </tr>
    <tr>
        <td class="title">
            任务排序ID
        </td>
        <td class="data">
            <input type="text" name="Order_Id" id="Order_Id" value="" />
        </td>
    </tr>
    <tr>
        <td class="title">
            任务名
        </td>
        <td class="data">
            <input type="text" name="Name" id="Name" value="" />
        </td>
    </tr>
    <tr>
        <td class="title">
            任务类型
        </td>
        <td class="data">
            <select name="Type" onclick="typeSelect()" id="Type">
                <option value="1">循环任务</option>
                <option value="2">主线任务</option>
                <option value="3">月卡任务</option>
                <option value="4">Vip特权任务</option>
            </select>
        </td>
    </tr>
    <tr>
        <td class="title" >
            循环任务开放时间
        </td>
        <td class="data">
            <input type="text" name="Circul_Open_Time" id="Circul_Open_Time" value="" style="visibility:hidden"/>
        </td>
    </tr>
    <tr>
        <td class="title" >
            循环任务结束时间
        </td>
        <td class="data">
            <input type="text" name="Circul_Over_Time" id="Circul_Over_Time" value="" style="visibility:hidden"/>
        </td>
    </tr>
    <tr>
        <td class="title">
            循环任务显示时间
        </td>
        <td class="data">
            <input type="text" name="Circul_Show_Time" id="Circul_Show_Time" value="" style="visibility:hidden"/>
        </td>
    </tr>

    <tr>
        <td class="title">
            任务说明
        </td>
        <td class="data">
            <textarea name="Des" id="Des" cols="45" rows="5"></textarea>
        </td>
    </tr>
    <tr>
        <td class="title">
            前置任务ID(任务名)
        </td>
        <td class="data">
            <select name="Pre_Task_Id" id="Pre_Task_Id">
                <option value="0">无 </option>
                <%results.forEach(function(task){%>
                <%if(task.Type != 3){%>
                <option value ="<%-task.Task_Id%>"><%-task.Task_Id%>(<%-task.Name%>) </option>
                <%}});%>
            </select>
        </td>
    </tr>
    <tr>
        <td class="title">
            任务接受战队等级（VIP任务为vip等级）
        </td>
        <td class="data">
            <input type="text" name="Open_Lvl" id="Open_Lvl" value="" />
        </td>
    </tr>
    <tr>
        <td class="title">
            任务发布时间
        </td>
        <td class="data">
            <input type="text" name="Open_Time" id="Open_Time" value="" />
        </td>
    </tr>
    <tr>
        <td class="title">
            任务过期时间
        </td>
        <td class="data">
            <input type="text" name="Over_Time" id="Over_Time" value="" />
        </td>
    </tr>

    <tr>
        <td class="title">
            任务状态
        </td>
        <td class="data">
            <select name="State" id="State">
                <option value="1">有效</option>
                <option value="2">无效</option>
            </select>
        </td>
    </tr>
    <tr>
        <td class="title">
            任务目标配置（当为vip任务时X为所属系列号，该任务接受一个就会放弃该系列其他任务）
        </td>
        <td class="data">
            <select name="Targets" id="Targets">
                <option value="1" <%if(results.Targets == 1){%> selected="selected"<%}%> >无目标</option>
                <option value="2" <%if(results.Targets == 2){%> selected="selected"<%}%> >完成指定关卡X次</option>
                <option value="3" <%if(results.Targets == 3){%> selected="selected"<%}%> >充值钻石X个</option>
                <option value="4" <%if(results.Targets == 4){%> selected="selected"<%}%> >达到战队等级X级</option>
                <option value="5" <%if(results.Targets == 5){%> selected="selected"<%}%> >抽奖X次</option>
                <option value="6" <%if(results.Targets == 6){%> selected="selected"<%}%> >点金X次</option>
                <option value="7" <%if(results.Targets == 7){%> selected="selected"<%}%> >完成任意普通关卡X次</option>
                <option value="8" <%if(results.Targets == 8){%> selected="selected"<%}%> >完成任意精英关卡X次</option>
                <option value="9" <%if(results.Targets == 9){%> selected="selected"<%}%> >完成时光之穴X次</option>
                <option value="10" <%if(results.Targets == 10){%> selected="selected"<%}%> >完成试炼王者X次</option>
                <option value="11" <%if(results.Targets == 11){%> selected="selected"<%}%> >进行PVP战斗X次</option>
                <option value="12" <%if(results.Targets == 12){%> selected="selected"<%}%> >Pvp获胜X次</option>
                <option value="13" <%if(results.Targets == 13){%> selected="selected"<%}%> >技能升级X次</option>
                <option value="14" <%if(results.Targets == 14){%> selected="selected"<%}%> >装备附魔X次</option>
                <option value="15" <%if(results.Targets == 15){%> selected="selected"<%}%> >进行X次远征</option>
                <option value="16" <%if(results.Targets == 16){%> selected="selected"<%}%> >拥有X品质的英雄Y位</option>
            </select>
            选择关卡:<select name="Stage_Id" id="Stage_Id">
                <option value="">无</option>
                <%
                stages.forEach(function(item){%>
                <option value="<%-item.Stage_Id%>,<%-item.Stage_Name%>"> <%-item.Stage_Name%>(<%-item.Stage_Type ==1?'<span class="red">普通</span>':'<span class="red">精英</span>'%>) </option>
                <%})%>
            </select>
            X:<input type="text" name="Param_X" id="Param_X" value="" />
            Y:<input type="text" name="Param_Y" id="Param_Y" value="" />
            Z:<input type="text" name="Param_Z" id="Param_Z" value="" />
        </td>
    </tr>
    <tr>
        <td class="title">
            任务图片配置
        </td>
        <td class="data">
            <input type="text" name="Pictures" id="Pictures" value="" />
        </td>
    </tr>
    <tr>
        <td class="title">
            预留参数X
        </td>
        <td class="data">
            <input type="text" name="Task_Go_Config" id="Task_Go_Config" value="" />
        </td>
    </tr>
</table>
    <table width="99%" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="#c0de98">
        <tr class="title">
            <td colspan="5">任务奖励配置信息</td>
        </tr>
        <td class="data">
            <table width="99%" border="0" cellpadding="0" cellspacing="1" bgcolor="#c0de98" >
                <tr colspan="2">
                    <td class="data">
                        <input type="text" name="Rewards" id="Rewards" value="<%=results.Rewards%>"  style="visibility: hidden"/>
                        选择奖励:<select name="User_Item_Add" id="User_Item_Add">
                            <option value="">无</option>
                            <%items.forEach(function(item){%>
                            <option value="<%-item.Item_Id%>,<%-item.Item_Name%>" ><%-item.Item_Name%></option>
                            <%})%>
                        </select>
                        数量:<input type="text" name="item_Amount" id="item_Amount" value=""  />
                        <label onclick="btn_addItem()">添加任务奖励</label>
                    </td>
                </tr>
                <tr colspan="2">
                    <table id="TB_ItemInit" name="TB_ItemInit" width="99%" border="0" cellpadding="0" cellspacing="1" bgcolor="#c0de98"></table>
                </tr>
            </table>
        </td>
    </table>
</form>

<script>
    document.onreadystatechange = function(){
        typeSelect();
    };

    function TargetsSelects(){


    }

    function typeSelect(){
        if(document.getElementById("Type").value == "1"){
            document.getElementById("Circul_Open_Time").style.visibility='visible';
            document.getElementById("Circul_Over_Time").style.visibility='visible';
            document.getElementById("Circul_Show_Time").style.visibility='visible';
        }
        else
        {
            document.getElementById("Circul_Open_Time").style.visibility='hidden';
            document.getElementById("Circul_Over_Time").style.visibility='hidden';
            document.getElementById("Circul_Show_Time").style.visibility='hidden';
        }
    }

   createTable('TB_ItemInit','Rewards','编号,道具名称,数量,操作');

    var btn_addItem = function(){
        var data_Add_Arr = [];
        var table_Title = '编号,道具名称,数量,操作';
        if(document.getElementById('Rewards').value!='undefined'){

            data_Add_Arr = JSON.parse(document.getElementById('Rewards').value);
        }

        data_Add_Arr.push(document.getElementById('User_Item_Add').value+','+document.getElementById('item_Amount').value);
        document.getElementById('Rewards').value=JSON.stringify(data_Add_Arr);
        addRow('Rewards','TB_ItemInit',table_Title);
    };


    var addRow =function(arr_Data_Id,table_Id,tb_Title){
        createTable(table_Id,arr_Data_Id,tb_Title);
    };

    function delRow(Data_Id,arr_Data_Id,table_Id,tb_Title){
        var arr_Data =  JSON.parse(document.getElementById(arr_Data_Id).value);
        arr_Data.splice(Data_Id,1);
        document.getElementById(arr_Data_Id).value=JSON.stringify(arr_Data);
        createTable(table_Id,arr_Data_Id,tb_Title);
    }

    function createTable(tabel_Id,arr_Data_Id,tb_Title){
        var arr_Data = '[]';
        if(document.getElementById(arr_Data_Id).value!="undefined"){
            arr_Data=document.getElementById(arr_Data_Id).value
        }
        var data_Rows = JSON.parse(arr_Data);

        var tb = document.getElementById(tabel_Id);
        var rowNum=tb.rows.length;
        for (var i=0;i<rowNum;i++)
        {
            tb.deleteRow(i);
            rowNum=rowNum-1;
            i=i-1;
        }
        var Rowi = 1;
        data_Rows.forEach(function(data_Row){
            var data_Cols = data_Row.split(',');
            var firstrow = tb.insertRow(0);
            var Coli = 0;
            data_Cols.forEach(function(data_Col){
                var firstcelltitle = firstrow.insertCell(Coli);
                firstcelltitle.setAttribute("class","data");
                firstcelltitle.innerHTML = data_Col;
                Coli++;
            });
            var firstcelldata = firstrow.insertCell(Coli);
            firstcelldata.setAttribute("class","data");
            var tb_Rowi = Rowi-1;
            firstcelldata.innerHTML = "<label onclick=delRow("+tb_Rowi+",'"+arr_Data_Id+"','"+tabel_Id+"','" +
                    tb_Title+"')>删除</label>";
            Rowi++;
        });
        var data_Cols = tb_Title.split(',');
        var firstrow = tb.insertRow(0);
        var Coli = 0;
        data_Cols.forEach(function(data_Col){
            var firstcelltitle = firstrow.insertCell(Coli);
            firstcelltitle.setAttribute("class","data");
            firstcelltitle.innerHTML = data_Col;
            Coli++;
        });

    }

</script>
